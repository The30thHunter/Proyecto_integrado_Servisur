{% extends "base_datos/base.html" %}
<!-- üíª Datos del equipo + Detalles de la orden -->
{% load static %}
<!-- üíª Datos del equipo + Detalles de la orden -->
{% block title %}Registrar Reparaci√≥n - Servisur{% endblock %}
<!-- üíª Datos del equipo + Detalles de la orden -->
{% block content %}
<link rel="stylesheet" href="{% static 'css/panel.css' %}" />

<div class="container py-4">
  <h3 class="mb-3 text-secondary">Registrar Reparaci√≥n</h3>

  {% if messages %}
  <div class="mb-3">
    {% for message in messages %}
    <div
      class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %}"
    >
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}

    <div class="row gx-3">
      <!-- üßç Datos del cliente -->
      <div class="col-lg-6">
        <div class="card mb-3 p-3">
          <h6 class="mb-3">Datos del cliente</h6>
          {{ cliente_form.as_p }}
        </div>
      </div>

      <!-- üíª Datos del equipo + Detalles de la orden -->
      <div class="col-lg-6">
        <div class="card mb-3 p-3">
          <h6 class="mb-3">Datos del equipo</h6>

          <!-- üè∑Ô∏è Marca -->
          <div class="mb-2">
            <label for="marca-select">Marca</label>
            <select
              id="marca-select"
              name="dispositivo-Marca"
              class="form-select"
              required
            >
              <option value="">Seleccione marca</option>
              {% for marca in dispositivo_form.fields.Marca.queryset %}
              <option value="{{ marca.id }}">{{ marca.Marca }}</option>
              {% endfor %}
              <option value="agregar_marca">‚ûï Agregar nueva marca</option>
            </select>
            <div class="invalid-feedback">Selecciona una marca v√°lida.</div>
          </div>

          <!-- ‚úèÔ∏è Campo para nueva marca -->
          <div
            id="nuevo-bloque-marca-modelo"
            class="mb-2"
            style="display: none"
          >
            <label for="nueva_marca">Nueva marca</label>
            <input
              type="text"
              id="nueva_marca"
              name="nueva_marca"
              class="form-control"
              placeholder="Ej: Rednote"
              autocomplete="off"
            />
            <div class="invalid-feedback">
              Ingresa el nombre de la nueva marca.
            </div>
          </div>

          <!-- üì¶ Modelo din√°mico -->
          <div class="mb-2">
            <label for="modelo-select">Modelo</label>
            <select
              id="modelo-select"
              name="dispositivo-modelo"
              class="form-select"
              disabled
            >
              <option value="">Seleccione modelo</option>
            </select>
            <div class="invalid-feedback">
              Selecciona un modelo v√°lido o agrega uno nuevo.
            </div>
          </div>

          <!-- ‚ûï Campo para agregar nuevo modelo -->
          <div id="nuevo-modelo-input" class="mb-2" style="display: none">
            <label for="nuevo_modelo">Nuevo modelo</label>
            <input
              type="text"
              id="nuevo_modelo"
              name="nuevo_modelo"
              class="form-control"
              placeholder="Ej: Galaxy A51"
              autocomplete="off"
            />
            <div class="invalid-feedback">
              Ingresa el nombre del nuevo modelo.
            </div>
          </div>

          <!-- üõ†Ô∏è Tipo de falla -->
          <div class="mb-2">
            <label for="tipo-falla-select">Tipo de falla</label>
            <select
              id="tipo-falla-select"
              name="dispositivo-Tipo_de_falla"
              class="form-select"
              required
            >
              <option value="">Seleccione tipo de falla</option>
              {% for falla in dispositivo_form.fields.Tipo_de_falla.queryset %}
              <option value="{{ falla.id }}">{{ falla.nombre }}</option>
              {% endfor %}
              <option value="agregar_falla">
                ‚ûï Agregar nuevo tipo de falla
              </option>
            </select>
          </div>

          <!-- ‚úèÔ∏è Campo para nueva falla -->
          <div id="nuevo-falla-input" class="mb-2" style="display: none">
            <label for="nueva_falla">Nuevo tipo de falla</label>
            <input
              type="text"
              id="nueva_falla"
              name="nueva_falla"
              class="form-control"
              placeholder="Ej: No enciende"
              autocomplete="off"
            />
          </div>

          <!-- ‚úèÔ∏è Campo para nueva reparaci√≥n -->
          <div id="nuevo-reparacion-input" class="mb-2" style="display: none">
            <label for="nueva_reparacion">Nuevo tipo de reparaci√≥n</label>
            <input
              type="text"
              id="nueva_reparacion"
              name="nueva_reparacion"
              class="form-control"
              placeholder="Ej: Cambio de pantalla"
              autocomplete="off"
            />
          </div>

          <!-- üîí C√≥digo de bloqueo -->
          <div class="mb-2">
            <label for="id_dispositivo-Codigo_Bloqueo">C√≥digo de bloqueo</label>
            <input
              type="text"
              id="id_dispositivo-Codigo_Bloqueo"
              name="dispositivo-Codigo_Bloqueo"
              class="form-control"
              placeholder="Ej: 1234, patr√≥n Z, sin bloqueo"
            />
            <div class="invalid-feedback">
              Ingresa un c√≥digo de bloqueo v√°lido.
            </div>
          </div>
        </div>

        <div class="card mb-3 p-3">
          <h6 class="mb-3">Detalles de la orden</h6>

          <div class="mb-2">
            {{ pedido_form.Fecha.label_tag }} {{ pedido_form.Fecha }} {{
            pedido_form.Fecha.errors }}
          </div>

          <div class="mb-2">
            {{ pedido_form.Coste.label_tag }} {{ pedido_form.Coste }} {{
            pedido_form.Coste.errors }}
          </div>

          <div class="mb-2">
            {{ pedido_form.Abono.label_tag }} {{ pedido_form.Abono }} {{
            pedido_form.Abono.errors }}
          </div>

          <div class="mb-2">
            {{ pedido_form.Restante.label_tag }} {{ pedido_form.Restante }} {{
            pedido_form.Restante.errors }}
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end">
      <button type="submit" class="btn btn-primary">Registrar</button>
    </div>
  </form>
</div>

<script src="{% static 'js/pedido.js' %}"></script>
{% endblock %}
