{% extends "base_datos/base.html" %}
{% load static %}
{% block title %}Registrar Reparaci√≥n - Servisur{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/panel.css' %}" />

<div class="d-flex flex-column min-vh-100">
  <div class="container py-4">
    <h3 class="mb-3 text-secondary">Registrar Reparaci√≥n</h3>

    {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}

      <div class="row gx-3">
        <!-- üßç Datos del cliente -->
        <div class="col-12">
          <div class="card mb-3 p-3 animate-slide-up">
            <h6 class="mb-3">üßç Datos del cliente</h6>

            <div class="mb-3">
              <label for="id_cliente-Nombre">Nombre</label>
              <input type="text" id="id_cliente-Nombre" name="cliente-Nombre" class="form-control" required />
            </div>

            <div class="mb-3">
              <label for="id_cliente-Apellido">Apellido</label>
              <input type="text" id="id_cliente-Apellido" name="cliente-Apellido" class="form-control" required />
            </div>

            <div class="mb-3">
              <label for="id_cliente-Numero_telefono">Tel√©fono</label>
              <input type="tel" id="id_cliente-Numero_telefono" name="cliente-Numero_telefono" class="form-control" required />
            </div>

            <div class="mb-3">
              <label for="id_cliente-Direccion">Direcci√≥n</label>
              <input type="text" id="id_cliente-Direccion" name="cliente-Direccion" class="form-control" required />
            </div>

            <div class="mb-3">
              <label for="id_cliente-Rut">RUT</label>
              <input type="text" id="id_cliente-Rut" name="cliente-Rut" class="form-control" required />
            </div>
          </div>
        </div>

        <!-- üíª Datos del equipo -->
        <div class="col-12">
          <div class="card mb-3 p-3 animate-slide-up">
            <h6 class="mb-3">Datos del equipo</h6>

            <div class="mb-2">
              <label for="marca-select">Marca</label>
              <select id="marca-select" name="dispositivo-Marca" class="form-select" required>
                <option value="">Seleccione marca</option>
                {% for marca in dispositivo_form.fields.Marca.queryset %}
                <option value="{{ marca.id }}">{{ marca.Marca }}</option>
                {% endfor %}
                <option value="agregar_marca">‚ûï Agregar nueva marca</option>
              </select>
            </div>

            <div id="nuevo-bloque-marca-modelo" class="mb-2" style="display: none">
              <label for="nueva_marca">Nueva marca</label>
              <input type="text" id="nueva_marca" name="nueva_marca" class="form-control" />
            </div>

            <div class="mb-2">
              <label for="modelo-select">Modelo</label>
              <select id="modelo-select" name="dispositivo-modelo" class="form-select" disabled>
                <option value="">Seleccione modelo</option>
              </select>
            </div>

            <div id="nuevo-modelo-input" class="mb-2" style="display: none">
              <label for="nuevo_modelo">Nuevo modelo</label>
              <input type="text" id="nuevo_modelo" name="nuevo_modelo" class="form-control" />
            </div>

            <div class="mb-2">
              <label for="tipo_falla">Tipo de falla</label>
              <textarea id="tipo_falla" name="dispositivo-Tipo_Falla" class="form-control" rows="3" required></textarea>
            </div>

            <div class="mb-2">
              <label for="id_dispositivo-Codigo_Bloqueo">C√≥digo de bloqueo</label>
              <input type="text" id="id_dispositivo-Codigo_Bloqueo" name="dispositivo-Codigo_Bloqueo" class="form-control" />
            </div>
          </div>
        </div>

        <!-- üìã Detalles de la orden -->
        <div class="col-12">
          <div class="card mb-3 p-3 animate-slide-up">
            <h6 class="mb-3">Detalles de la orden</h6>

            <div class="mb-2">
              <label for="fecha_orden">Fecha de ingreso</label>
              <input type="date" id="fecha_orden" name="pedido-Fecha" class="form-control" required />
            </div>

            <div class="mb-2">
              <label for="costo_total">Costo total</label>
              <input type="number" id="costo_total" name="pedido-Coste" class="form-control" min="0" required />
            </div>

            <div class="mb-2">
              <label for="abono">Abono</label>
              <input type="number" id="abono" name="pedido-Abono" class="form-control" min="0" />
            </div>

            <div class="mb-2">
              <label for="restante">Restante</label>
              <input type="number" id="restante" name="pedido-Restante" class="form-control" readonly />
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-primary">Registrar</button>
      </div>
    </form>
  </div>

  <footer class="mt-auto text-center small text-muted">
    <hr />
    <p class="mb-1">Sistema Servisur &copy; {{ now|date:"Y" }} ‚Äî Registro de Reparaciones</p>
    <p class="mb-0">Desarrollado por el equipo t√©cnico | Versi√≥n 1.0</p>
  </footer>
</div>

<script src="{% static 'js/pedido.js' %}"></script>
<script src="{% static 'js/validaciones.js' %}"></script>
{% endblock %}